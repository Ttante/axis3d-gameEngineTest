<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../../">
  <title data-ice="title">src/mesh.js | API Document</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  
  
  <script src="script/manual.js"></script>
</head>
<body class="layout-container" data-ice="rootContainer">

<header>
  <a href="./">Home</a>
  
  <a href="identifiers.html">Reference</a>
  <a href="source.html">Source</a>
  
  
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
</header>

<nav class="navigation" data-ice="nav"><div>
  <ul>
    
  <li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/camera.js~CameraCommand.html">CameraCommand</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/command.js~Command.html">Command</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/command.js~CommandContext.html">CommandContext</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/context.js~Context.html">Context</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/controller.js~ControllerCommand.html">ControllerCommand</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/feedback.js~FeedbackCommand.html">FeedbackCommand</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/frame.js~FrameCommand.html">FrameCommand</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/fullscreen.js~FullscreenCommand.html">FullscreenCommand</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/geometry.js~Geometry.html">Geometry</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/media.js~MediaCommand.html">MediaCommand</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/mesh.js~MeshCommand.html">MeshCommand</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-DEFAULT_CAMERA_FAR">DEFAULT_CAMERA_FAR</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-DEFAULT_CAMERA_FIELD_OF_VIEW">DEFAULT_CAMERA_FIELD_OF_VIEW</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-DEFAULT_CAMERA_NEAR">DEFAULT_CAMERA_NEAR</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-DEFAULT_CAMERA_ORIENTATION_ORIGIN">DEFAULT_CAMERA_ORIENTATION_ORIGIN</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-encode">encode</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-defaults">defaults</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-DEFAULT_FRAGMENT_SHADER">DEFAULT_FRAGMENT_SHADER</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-DEFAULT_VERTEX_SHADER">DEFAULT_VERTEX_SHADER</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-$ctx">$ctx</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-$current">$current</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-$domElement">$domElement</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-$hasFocus">$hasFocus</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-$previous">$previous</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-$ref">$ref</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-$regl">$regl</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-$reglContext">$reglContext</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-$run">$run</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-$stack">$stack</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-$state">$state</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-debug">debug</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-define">define</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-getScreenOrientation">getScreenOrientation</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-isDOMElementInViewport">isDOMElementInViewport</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-lerp">lerp</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-radians">radians</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">controls/ambisonic-audio</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/controls/ambisonic-audio/index.js~AmbisonicAudioControllerCommand.html">AmbisonicAudioControllerCommand</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">controls/first-person-camera</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/controls/first-person-camera/index.js~FirstPersonCameraController.html">FirstPersonCameraController</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">controls/orbit-camera</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/controls/orbit-camera/index.js~OrbitCameraController.html">OrbitCameraController</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-DEFAULT_FRICTION">DEFAULT_FRICTION</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">geometry</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/geometry/box.js~BoxGeometry.html">BoxGeometry</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/geometry/plane.js~PlaneGeometry.html">PlaneGeometry</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/geometry/sphere.js~SphereGeometry.html">SphereGeometry</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/geometry/triangle.js~TriangleGeometry.html">TriangleGeometry</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">input</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/input/keyboard.js~KeyboardCommand.html">KeyboardCommand</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/input/mouse.js~MouseCommand.html">MouseCommand</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/input/orientation.js~OrientationCommand.html">OrientationCommand</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/input/touch.js~TouchCommand.html">TouchCommand</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">math</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/math/quaternion.js~Quaternion.html">Quaternion</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/math/vector.js~Vector.html">Vector</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-XVector3">XVector3</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-YVector3">YVector3</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-ZVector3">ZVector3</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">media</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/media/audio.js~AudioCommand.html">AudioCommand</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/media/image.js~ImageCommand.html">ImageCommand</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/media/video.js~VideoCommand.html">VideoCommand</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">mesh</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/mesh/box.js~BoxCommand.html">BoxCommand</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/mesh/plane.js~PlaneCommand.html">PlaneCommand</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/mesh/sphere.js~SphereCommand.html">SphereCommand</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/mesh/triangle.js~TriangleCommand.html">TriangleCommand</a></span></span></li>
</ul>
</div>
</nav>

<div class="content" data-ice="content"><h1 data-ice="title">src/mesh.js</h1>
<pre class="source-code line-number raw-source-code"><code class="prettyprint linenums" data-ice="content">&apos;use strict&apos;

/**
 * Module dependencies.
 */

import { Quaternion, Vector } from &apos;./math&apos;
import { $reglContext } from &apos;./symbols&apos;
import getBoundingBox from &apos;bound-points&apos;
import injectDefines from &apos;glsl-inject-defines&apos;
import { Command } from &apos;./command&apos;
import { define } from &apos;./utils&apos;
import glslify from &apos;glslify&apos;
import mat4 from &apos;gl-mat4&apos;
import vec4 from &apos;gl-vec4&apos;
import vec3 from &apos;gl-vec3&apos;
import vec2 from &apos;gl-vec2&apos;
import quat from &apos;gl-quat&apos;

/**
 * Default vertex shader for a mesh.
 *
 * @public
 * @const
 * @type {String}
 */

export const DEFAULT_VERTEX_SHADER = glslify(__dirname + &apos;/glsl/mesh/vert.glsl&apos;)

/**
 * Default fragment shader for a mesh.
 *
 * @public
 * @const
 * @type {String}
 */

export const DEFAULT_FRAGMENT_SHADER = glslify(__dirname + &apos;/glsl/mesh/frag.glsl&apos;)

/**
 * Current mesh command counter.
 *
 * @type {Number}
 */

let MESH_COMMAND_COUNTER = 0

/**
 * MeshCommand constructor.
 * @see MeshCommand
 */

export default (...args) =&gt; new MeshCommand(...args)

/**
 * MeshCommand class.
 *
 * @public
 * @class MeshCommand
 * @extends Command
 */

export class MeshCommand extends Command {

  /**
   * Returns the next mesh D
   *
   * @public
   * @static
   * @return {Number}
   */

  static id() {
    return MESH_COMMAND_COUNTER ++
  }

  /**
   * MeshCommand class constructor.
   *
   * @param {Context} ctx
   * @param {Object} opts
   */

  constructor(ctx, opts = {}) {
    const reglOptions = { ...opts.regl }
    const defaults = { ...opts.defaults }
    const model = mat4.identity([])

    let hasInitialUpdate = false
    let boundingBox = null
    let blending = opts.blending || null
    let render = null
    let envmap = null
    let depth = opts.depth || null
    let draw = opts.draw || null
    let map = opts.map || null

    const previous = {
      rotation: new Quaternion(0, 0, 0, 1),
      position: new Vector(0, 0, 0),
      opacity: 1,
      scale: new Vector(1, 1, 1),
      color: new Vector(0, 0, 0, 0),
    }

    /**
     * Sets mesh map.
     *
     * @private
     * @param {Media|null} value
     */

    const setMap = (value) =&gt; {
      if (value &amp;&amp; value != map) {
        if (value) {
          map = value
          configure()
        }
      } else if (null === value &amp;&amp; null != map) {
        map = null
        configure()
      }
    }

    /**
     * Updates state and internal matrices.
     *
     * @private
     * @param {Object} [state]
     */

    const update = (state) =&gt; {
      let needsUpdate = !hasInitialUpdate

      if (&apos;scale&apos; in state) {
        vec3.copy(this.scale, state.scale)
        needsUpdate = true
      }

      if (&apos;position&apos; in state) {
        vec3.copy(this.position, state.position)
      }

      if (&apos;rotation&apos; in state) {
        quat.copy(this.rotation, state.rotation)
      }

      if (&apos;color&apos; in state) {
        vec4.copy(this.color, state.color)
        needsUpdate = true
      }

      if (&apos;wireframe&apos; in state) {
        this.wireframe = Boolean(state.wireframe)
        needsUpdate = true
      }

      if (&apos;opacity&apos; in state) {
        this.opacity = state.opacity
        needsUpdate = true
      }

      if (&apos;blending&apos; in state) {
        this.blending = state.blending
        needsUpdate = true
      }

      if (ctx.previous &amp;&amp; ctx.previous.id != this.id) {
        needsUpdate = true
      }

      if (&apos;map&apos; in state &amp;&amp; map != state.map) {
        setMap(state.map)
        needsUpdate = true
      } else if (&apos;envmap&apos; in state &amp;&amp; envmap != state.envmap) {
        needsUpdate = true
        this.envmap = state.map
      }

      if (false == needsUpdate) {
        return
      }

      hasInitialUpdate = true

      if (envmap) {
        this.scale.x = -1
        // @TODO(werle) flipY should be exposed from texture constructor
        if (envmap.texture &amp;&amp; envmap.texture._texture.flipY) {
          this.scale.y = -1
        }
      }

      // update uniform model matrix
      mat4.identity(model)
      mat4.scale(model, model, this.scale)
      mat4.translate(model, model, this.position)
      mat4.multiply(model, model, mat4.fromQuat([], this.rotation))

      // apply and set contextual transform
      if (ctx.previous &amp;&amp; ctx.previous.id != this.id) {
        mat4.multiply(this.transform, ctx.previous.transform, model)
        mat4.copy(model, this.transform)
      } else {
        mat4.copy(this.transform, model)
      }
    }

    /**
     * Configures mesh state. This function
     * may create a new render function from regl
     *
     * @private
     */

    const configure = () =&gt; {
      const self = this
      if (!self) { return }
      // reset draw function
      if (!opts.draw) { draw = null }
      // use regl draw command if draw() function
      // was not provided
      if (false !== draw &amp;&amp; &apos;function&apos; != typeof draw) {
        const geometry = opts.geometry || null
        const elements = geometry ? geometry.primitive.cells : undefined
        const attributes = {...opts.attributes}
        const shaderDefines = {}

        const uniforms = {
          ...opts.uniforms,
          opacity() {
            return null != self.opacity ? parseFloat(self.opacity) : 1
          },
          color() { return self.color ? self.color.elements : [0, 0, 0, 0]},
          model() { return model },
        }

        defaults.primitive = opts.primitive || &apos;triangles&apos;

        if (geometry &amp;&amp; !this.geometry) {
          this.geometry = geometry
        }

        if (geometry) {
          if (geometry.primitive.positions) {
            shaderDefines.HAS_POSITIONS = &apos;&apos;
            attributes.position = geometry.primitive.positions
          }

          if (geometry.primitive.normals) {
            shaderDefines.HAS_NORMALS = &apos;&apos;
            attributes.normal = geometry.primitive.normals
          }

          if (geometry.primitive.uvs) {
            shaderDefines.HAS_UVS = &apos;&apos;
            attributes.uv = geometry.primitive.uvs
          }
        }

        if (map &amp;&amp; map.texture) {
          uniforms.map = () =&gt; {
            if (map &amp;&amp; map.texture) {
              if (&apos;function&apos; == typeof map) { map() }
              return map.texture
            }

            return null
          }
        } else if (map) {
          map.once(&apos;load&apos;, () =&gt; configure())
        }

        if (!opts.primitive &amp;&amp; opts.wireframe) {
          opts.primitive = &apos;lines&apos;
        }

        Object.assign(reglOptions, {
          context: {
            ...reglOptions.context,
            color: uniforms.color(),
            model: uniforms.model(),
          },

          uniforms, attributes,
          vert: undefined !== opts.vert ? opts.vert : DEFAULT_VERTEX_SHADER,
          frag: undefined !== opts.frag ? opts.frag : DEFAULT_FRAGMENT_SHADER,
          depth: null != depth ? depth : {enable: true},
          blend: null != blending ? blending : {
            enable: true,
            func: {
              src: &apos;src alpha&apos;,
              dst: &apos;one minus src alpha&apos;
            },
          },
          primitive: null == geometry ? undefined : () =&gt; {
            if (this.wireframe) { return &apos;lines&apos; }
            else if (opts.primitive) { return opts.primitive }
            else { return defaults.primitive }
          }
        })

        if (geometry) {
          Object.assign(reglOptions, {
            elements: geometry &amp;&amp; geometry.cells || function (ctx, props) {
              props = props || {}
              return props.elements || geometry ? geometry.cells : null
            },

          })

          if (opts.count) {
            reglOptions.count = opts.count
          } else if (geometry &amp;&amp; geometry.primitive) {
            reglOptions.count = geometry.primitive.count
          }
        }

        if (uniforms.map) {
          shaderDefines.HAS_MAP = &apos;&apos;
        }

        if (reglOptions.frag) {
          reglOptions.frag = injectDefines(reglOptions.frag, shaderDefines)
        }

        if (reglOptions.vert) {
          reglOptions.vert = injectDefines(reglOptions.vert, shaderDefines)
        }

        for (let key in reglOptions) {
          if (undefined === reglOptions[key]) {
            delete reglOptions[key]
          }
        }

        for (let key in defaults) {
          if (undefined === defaults[key]) {
            delete defaults[key]
          }
        }

        if (reglOptions.vert &amp;&amp; reglOptions.frag) {
          draw = ctx.regl(reglOptions)
        }
      }

      // configure render command
      render = opts.render || ((_, state = {}, next = () =&gt; void 0) =&gt; {
        let args = null

        ctx.push(this)

        if (&apos;function&apos; == typeof state) {
          args = [{...defaults}]
          next = state
          state = {}
        } else if (Array.isArray(state)) {
          args = [state.map((o) =&gt; Object.assign({...defaults}, o))]
        } else {
          args = [{...defaults, ...state}]
        }

        const props = Array.isArray(state)
          ? state.map((o) =&gt; ({ ...defaults, ...o }))
          : ({...defaults, ...state})

        const block = () =&gt; {
          next({...(ctx[$reglContext] || {}), ...reglOptions.context })
        }

        opts.before &amp;&amp; opts.before(...args)
        update(...args)
        draw(props)
        block()
        opts.after &amp;&amp; opts.after({...defaults, ...state}, block)
        ctx.pop()
      })
    }

    // calls current target  render function
    super((...args) =&gt; render(...args))

    /**
     * Mesh ID.
     *
     * @type {Number}
     */

    this.id = opts.id || MeshCommand.id()

    /**
     * Mesh type name.
     *
     * @type {String}
     */

    this.type = opts.type || &apos;object&apos;

    /**
     * Mesh scale vector.
     *
     * @type {Vector}
     */

    this.scale = opts.scale ?
      new Vector(...opts.scale) :
      new Vector(1, 1, 1)

    /**
     * Mesh position vector.
     *
     * @type {Vector}
     */

    this.position = opts.position ?
      new Vector(...opts.position) :
      new Vector(0, 0, 0)

    /**
     * Mesh rotation quaternion
     *
     * @type {Quaternion}
     */

    this.rotation = opts.rotation ?
      new Quaternion(...opts.rotation) :
      new Quaternion()

    /**
     * Mesh transform matrix
     *
     * @type {Array}
     */

    this.transform = mat4.identity([])

    /**
     * Boolean to indicate if mesh should be drawn
     * with a line primitive.
     *
     * @type {Boolean}
     */

    this.wireframe = false

    /**
     * Mesh color property.
     *
     * @type {Vector}
     */

    this.color = opts.color ?
      new Vector(...opts.color) :
      new Vector(197/255, 148/255, 149/255, 1.0)

    /**
     * Mesh opacity.
     *
     * @type {Number}
     */

    this.opacity = opts.opacity || 1

    /**
     * Computed bounding
     *
     * @type {Array&lt;Vector&gt;}
     */

    define(this, &apos;boundingBox&apos;, {
      get() {
        if (null == this.geometry) {
          return null
        } else if (boundingBox) {
          return boundingBox
        }

        boundingBox =
          getBoundingBox(this.geometry.positions).map((p) =&gt; new Vector(...p))
        return boundingBox
      }
    })

    /**
     * Computed size.
     *
     * @type {Vector}
     */

    define(this, &apos;size&apos;, {
      get() {
        // trigger compute with getter
        if (null == this.boundingBox) {
          return null
        }

        const min = boundingBox[0]
        const max = boundingBox[1]
        const dimension = boundingBox[0].length

        switch (dimension) {
          case 3: return vec3.subtract(new Vector(0, 0, 0), max, min)
          case 2: return vec2.subtract(new Vector(0, 0, 0), max, min)
          default: return null
        }
      }
    })

    /**
     * Mesh texture map if given.
     *
     * @type {Media}
     */

    define(this, &apos;map&apos;, {
      get: () =&gt; map,
      set: (value) =&gt; setMap(value)
    })

    /**
     * Mesh texture environment map if given.
     *
     * @type {Media}
     */

    define(this, &apos;envmap&apos;, {
      get: () =&gt; envmap,
      set: (value) =&gt; {
        if (null == value) {
          envmap = null
        } else if (value != envmap) {
          envmap = value
          setMap(value)
        }
      }
    })

    // set envmap from input
    this.envmap = opts.envmap

    /**
     * Toggles blending.
     *
     * @type {Boolean|Object}
     */

    define(this, &apos;blending&apos;, {
      get: () =&gt; blending,
      set: (value) =&gt; {
        blending = value
        configure()
      }
    })

    /**
     * Toggles depth.
     *
     * @type {Boolean|Object}
     */

    define(this, &apos;depth&apos;, {
      get: () =&gt; depth,
      set: (value) =&gt; {
        depth = value
        configure()
      }
    })

    // initial configuration
    configure()
  }
}
</code></pre>

</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(0.4.8)</span></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>
